<!doctype html>
<html>
<head>

    <title>Stallion (Official)</title>

    <meta charset="utf-8">

    <!--font-->
    <link href='http://fonts.googleapis.com/css?family=Stardos+Stencil:400,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>

    <!--social media icons font-->
    <link rel="stylesheet" href="ExternalFrameworks/monosocialiconsfont/monosocialiconsfont.css">

    <!--user css for font-->
    <link rel="stylesheet" href="StallionMain.css">

    <script>

        /**
         * some helper functions
         */
        function startsWith(givenString, prefix)
        {
            return givenString.lastIndexOf(prefix, 0) === 0;
        }

        function removeFirstNCharacters(givenString, n)
        {
            return givenString.substring(n);
        }

        function getCountryFromLocation(location)
        {
            return location.split(",")[1];
        }

        function getCityFromLocation(location)
        {
            return location.split(",")[0];
        }

        /**
         * parse and format raw data into human readable string
         */
        function parseEventsToReadableString(events)
        {
            var parsedData = [];

            for (var i = 0; i < events.length; i++)
            {
                try
                {
                    var event = events[i];

                    var eventName = event.summary;
                    var location = event.location;
                    var date = new Date(event.startDate);

                    if (eventName)
                    {
                        if (startsWith(eventName, "FIX:") === true)
                        {

                            var formattedVenue = removeFirstNCharacters(eventName, 4).trim();
                            var formattedDate = date.toISOString().slice(0, 10).trim();
                            var formattedCountry = getCountryFromLocation(location).trim();
                            var formattedCity = getCityFromLocation(location).trim();

                            var contentString = formattedDate + " " + formattedCountry.toUpperCase() + " " + formattedCity + ", " + formattedVenue;
                            parsedData.push(contentString);
                        }
                    }
                }
                catch (e)
                {
                    console.log("unable to parse event " + event.summary + ", reason: " + e);
                }
            }

            return parsedData;
        }

        /**
         * php data arrived callback
         */
        function onEventsReceived(events)
        {
            var readableEvents = parseEventsToReadableString(events);

            if (readableEvents.length > 0)
            {
                var htmlContainer = $("#tourDateContainer").empty();

                for (var i = 0; i < readableEvents.length; i++)
                {

                    htmlContainer.append(readableEvents[i] + "<br>");
                }
            }
        }

        /**
         * get event from google calendar via PHP and service account
         */
        function loadGoogleCalendarEventsViaPHP()
        {
            $.post(
                'get-data.php',
                function (result) {

                    onEventsReceived(result)
                },
                'json'
            );
        }

        // let's do it
        loadGoogleCalendarEventsViaPHP();

    </script>

</head>

<body>

<div class="container">

    <!-- header -->
    <h1 align="center"
        class="title">
        Stallion (Official)
    </h1>

    <div class="upper-row">

        <!-- links -->
        <div class="unified-flex-size med-font left-column"
             align="center">

            <div>
                <div class="heading">Band Information</div>
                <a href="http://www.metal-archives.com/bands/Stallion/3540367297">The Metal Archives</a><br>
                <a href="http://de.wikipedia.org/wiki/Stallion_(Band)">Wikipedia</a><br>
            </div>

            <div>
                <div class="heading">Merch</div>
                <a href="http://www.heavymetalstallion.com/Store">Shop (run by the Band, ships worldwide)</a>
            </div>

            <div>
                <div class="heading">Contact & Booking</div>
                <a href="mailto:emma@blackbirdartists.com" onclick="">info@heavymetalstallion.com</a>
            </div>

        </div>

        <!-- band photo -->
        <div class="unified-flex-size"
             align="center">
            <a href="http://www.metal-archives.com/bands/Stallion/3540367297">
                <img src="img/title.jpg" class="band-photo">
            </a>
        </div>

        <!--social media (colored icons, not used atm)-->
        <div class="unified-flex-size social-media-link-container" style="display: none">

            <a href="http://www.heavymetalstallion.com/Facebook"
               class="social-media-link">
                <img src="img/facebook.svg" alt="Facebook">
            </a>

            <a href="http://www.instagram.com/heavymetalstallion"
               class="social-media-link">
                <img src="img/instagram.svg" alt="Instagram">
            </a>

            <a href="http://www.heavymetalstallion.com/Youtube"
               class="social-media-link">
                <img src="img/youtube.svg" alt="YouTube">
            </a>

            <a href="http://open.spotify.com/artist/4H7l564NLNANlnd5rIrJjy"
               class="social-media-link">
                <img src="img/spotify.svg" alt="Spotify">
            </a>

        </div>

        <!--social media (monochrome icons, used atm)-->
        <div class="unified-flex-size social-media-link-container">

            <a href="http://www.heavymetalstallion.com/Facebook"
               class="social-media-link-mono-social-icons">
                <span class='symbol'>circlefacebook</span>
            </a>

            <a href="http://www.instagram.com/heavymetalstallion"
               class="social-media-link-mono-social-icons">
                <span class='symbol'>circleinstagram</span>
            </a>

            <a href="http://www.heavymetalstallion.com/Youtube"
               class="social-media-link-mono-social-icons">
                <span class='symbol'>circleyoutube</span>
            </a>

            <a href="http://open.spotify.com/artist/4H7l564NLNANlnd5rIrJjy"
               class="social-media-link-mono-social-icons">
                <span class='symbol'>circlespotify</span>
            </a>

        </div>

    </div>

    <br>

    <!-- tour dates heading -->
    <div align="center"
         class="heading">
        upcoming shows
    </div>

    <!-- tour dates content -->
    <div align="center"
         class="med-font">

        <div align="center"
             id="tourDateContainer"
             style="display: inline-block; text-align: left;">
            loading tour dates...
        </div>

    </div>

</div>

</body>
</html>