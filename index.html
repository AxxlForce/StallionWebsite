<!doctype html>
<html>
<head>

    <title>Stallion (Official) Website</title>

    <meta charset="utf-8">

    <!--font-->
    <link href='http://fonts.googleapis.com/css?family=Stardos+Stencil:400,700' rel='stylesheet' type='text/css'>

    <!--jQuery-->
    <script src="ExternalFrameworks/jquery/jquery-2.1.1.min.js"></script>

    <!--bootstrap-->
    <link rel="stylesheet" href="ExternalFrameworks/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="ExternalFrameworks/bootstrap/css/bootstrap-responsive.css">
    <script src="ExternalFrameworks/bootstrap/js/bootstrap.js"></script>

    <!--user css for font-->
    <link rel="stylesheet" href="StallionMain.css">

    <script>

        /**
         * some helper functions
         */
        function startsWith(givenString, prefix)
        {
            return givenString.lastIndexOf(prefix, 0) === 0;
        }

        function removeFirstNCharacters(givenString, n)
        {
            return givenString.substring(n);
        }

        function getCountryFromLocation(location)
        {
            return location.split(",")[1];
        }

        function getCityFromLocation(location)
        {
            return location.split(",")[0];
        }

        /**
         * parse and format raw data into human readable string
         */
        function parseEventsToReadableString(events)
        {
            var parsedData = [];

            for (var i = 0; i < events.length; i++)
            {
                try
                {
                    var event = events[i];

                    var eventName = event.summary;
                    var location = event.location;
                    var date = new Date(event.startDate);

                    if (eventName)
                    {
                        if (startsWith(eventName, "FIX:") === true)
                        {

                            var formattedVenue = removeFirstNCharacters(eventName, 4).trim();
                            var formattedDate = date.toISOString().slice(0, 10).trim();
                            var formattedCountry = getCountryFromLocation(location).trim();
                            var formattedCity = getCityFromLocation(location).trim();

                            var contentString = formattedDate + " " + formattedCountry.toUpperCase() + " " + formattedCity + ", " + formattedVenue;
                            parsedData.push(contentString);
                        }
                    }
                }
                catch (e)
                {
                    console.log("unable to parse event " + event.summary + ", reason: " + e);
                }
            }

            return parsedData;
        }

        /**
         * php data arrived callback
         */
        function onEventsReceived(events)
        {
            var readableEvents = parseEventsToReadableString(events);

            if (readableEvents.length > 0)
            {
                var htmlContainer = $("#tourDateContainer").empty();

                for (var i = 0; i < readableEvents.length; i++)
                {

                    htmlContainer.append(readableEvents[i] + "<br>");
                }
            }
        }

        /**
         * get event from google calendar via PHP and service account
         */
        function loadGoogleCalendarEventsViaPHP()
        {
            $.post(
                'get-data.php',
                function (result) {

                    onEventsReceived(result)
                },
                'json'
            );
        }

        // let's do it
        loadGoogleCalendarEventsViaPHP();

    </script>

</head>

<body>

<div class="container-fluid">

    <br>

    <!-- header -->
    <h1 align="center" class="row-fluid">
        Stallion (Official)
    </h1>

    <!-- band photo -->
    <div align="center">
        <a href="http://www.metal-archives.com/bands/Stallion/3540367297">
            <img src="img/title.jpg" width="300" height="300">
        </a>
    </div>

    <!-- links -->
    <h4 align="center" class="row-fluid">
        please visit:<br><br>
        <a href="http://www.metal-archives.com/bands/Stallion/3540367297">"The Metal Archives" for band information</a><br>
        <a href="http://de.wikipedia.org/wiki/Stallion_(Band)">Wikipedia article (german only)</a><br>
        <a href="http://www.heavymetalstallion.com/Youtube">official Youtube channel</a><br>
        <a href="http://www.instagram.com/heavymetalstallion">Instagram</a><br>
        <a href="http://www.heavymetalstallion.com/Facebook">Facebook</a><br>
        <a href="http://www.heavymetalstallion.com/Store">merch store</a>
    </h4>

    <br>

    <!-- sub header -->
    <h2 align="center" class="row-fluid">
        upcoming shows
    </h2>

    <!-- content: tour dates -->
    <div align="center" class="row-fluid">
        <h3 align="center" id="tourDateContainer" style="display: inline-block;text-align: left;">
            loading tour dates...
        </h3>
    </div>

</div>

</body>
</html>